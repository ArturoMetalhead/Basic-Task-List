{% extends "TaskListApp/base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}TaskList{% endblock %}


{% block content %}



<form id="taskForm" method="post" action="{% url 'add_task' %}" class="task-box">
  {% csrf_token %}

  <!-- Input con ícono -->
  <div class="input-wrapper">
    <span id="plusToggle" class="plus-icon">
      <i data-feather="plus-square"></i>
    </span>
    <input type="text" name="title" id="taskInput"
           class="form-control task-input ps-5"
           placeholder="Type to add new task">
  </div>

  <!-- Botones debajo -->
  <div id="leftButtons" class="task-buttons fade-buttons">
    <div id="extraButtons" class="d-flex flex-wrap gap-2">
      <button type="button" class="task-button" disabled><i data-feather="maximize-2"></i> Open</button>
      <button type="button" class="task-button" disabled><i data-feather="calendar"></i> Today</button>
      <button type="button" class="task-button" disabled><i data-feather="lock"></i> Public</button>
      <button type="button" class="task-button" disabled><i data-feather="sun"></i> Highlight</button>
      <button type="button" class="task-button" disabled><i data-feather="circle"></i> Estimation</button>
    </div>
    <div class="btn-group-right">
      <button type="button" class="task-button btn-cancel" id="cancelBtn" disabled>Cancel</button>
      <button type="submit" class="task-button btn-ok" id="okBtn">Ok</button>
    </div>
  </div>
</form>

<ul class="list-group mt-3">
  {% for task in tasks %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      
      <div class="d-flex align-items-center w-100">
        <form method="post" action="{% url 'delete_task' task.id %}" onsubmit="return confirm('Delete this task?');" class="me-3">
          {% csrf_token %}
          <input type="checkbox" onchange="this.form.submit()" />
        </form>
        <span>{{ task.title|highlight_tags }}</span>
      </div>

    </li>
  {% empty %}
    <li class="list-group-item">No tasks yet.</li>
  {% endfor %}
</ul>


<!-------------------SCRIPTS------------------>

<script>
  const input = document.getElementById('taskInput');
  const okBtn = document.getElementById('okBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const form = document.getElementById('taskForm');
  const leftButtonsContainer = document.getElementById('leftButtons');
  const leftButtons = document.querySelectorAll('#extraButtons button');
  //const leftButtons = leftButtonsContainer.querySelectorAll('button');
  const plusToggle = document.getElementById('plusToggle');

  // Mostrar botones al hacer foco en el input
  input.addEventListener('focus', () => {
    leftButtonsContainer.classList.add('show');
  });

  // Habilitar/deshabilitar botones según el texto
  input.addEventListener('input', () => {
    const isEmpty = input.value.trim() === "";

    // Cambiar texto del botón OK
    okBtn.textContent = isEmpty ? "Ok" : "Add";

    // Cancel solo se habilita si hay texto
    cancelBtn.disabled = isEmpty;

    // Otros botones se habilitan solo con texto
    leftButtons.forEach(btn => {
      btn.disabled = isEmpty;
    });
  });

  // Ocultar los botones si pierde foco y no hay texto
  input.addEventListener('blur', () => {
    setTimeout(() => {
      if (input.value.trim() === "") {
        leftButtonsContainer.classList.remove('show');
      }
    }, 100);
  });

  // Cancelar limpia el input y desactiva todo
  cancelBtn.addEventListener('click', () => {
    input.value = "";
    okBtn.textContent = "Ok";
    cancelBtn.disabled = true;
    leftButtons.forEach(btn => btn.disabled = true);
    leftButtonsContainer.classList.remove('show');
  });

  // Evita submit si está vacío
  form.addEventListener('submit', (e) => {
    if (input.value.trim() === "") {
      e.preventDefault();
    }
  });
   
  // Mostrar botones al hacer clic en el botón de más
  plusToggle.addEventListener('click', () => {
  if (!leftButtonsContainer.classList.contains('show')) {
    leftButtonsContainer.classList.add('show');
    input.focus();
  }
});

</script>
  
{% endblock %}